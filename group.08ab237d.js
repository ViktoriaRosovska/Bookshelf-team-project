let e,t;function r(e){return e&&e.__esModule?e.default:e}var a,n,o,i,s,l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},c={},h={},d=l.parcelRequire9432;null==d&&((d=function(e){if(e in c)return c[e].exports;if(e in h){var t=h[e];delete h[e];var r={id:e,exports:{}};return c[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){h[e]=t},l.parcelRequire9432=d),d("3L4y6"),d("bUb57"),d("4R95q");var u=(d("3L4y6"),d("3L4y6"));const f=document.querySelector(".books-gallery"),p=new u.APIService;async function g(e){let t=await p.fetchBooksByCategory(e),r=await t.data;console.log(r),f.innerHTML=`<h1 class="collection-title">Books</h1>
    <ul class="top-books rendering-gap js-list-rendering">
    ${r.map(({title:e,book_image:t,author:r,_id:a})=>`<li class="book-card" id="${a}">
      <img class="book-cover" src="${t}" alt="${e}">
      <h2 class="book-name">${e}</h2>
      <h3 class="book-author">${r}</h3>
  </li>`).join("")}
    </ul>`}const m=new u.APIService,b=document.querySelector(".book-category__list");async function y(){let e=await m.fetchBooksCategoryList(),t=await e.data;return t}async function v(){try{let e=await y(),t=e.map(e=>`<li class="book-category__list-item">${e.list_name}</li>`).join("");b.insertAdjacentHTML("beforeend",t)}catch(e){console.log(e)}}async function E(e){if("LI"===e.target.nodeName){if(console.log(e.target),e.target.classList.contains("active"))e.target.classList.remove("active");else{let t=document.querySelectorAll(".book-category__list-item");t.forEach(e=>e.classList.remove("active")),e.target.classList.add("active")}await g(e.target.textContent)}}b&&(v(),b.addEventListener("click",E));var u=d("3L4y6");const w=new u.APIService,_=document.querySelector(".books-collection");async function S(){let e=await w.fetchBestSellersBooks(),t=await e.data;return t}async function k(){let e="",t=await S();for(let r of(console.log(t),t))e+=`
    <li class="book-category-item">
      <p class="book-category">${r.list_name}</p>
      <ul class="top-books js-list-rendering">
        ${r.books.map(e=>`
              <li class="book-card flex-element" id=${e._id}>
                <img class="book-cover" src="${e.book_image}" alt="${e.title}" />
                <h2 class="book-name">${e.title}</h2>
                <h3 class="book-author">${e.author}</h3>
              </li>
            `).join("")}
      </ul>
      <button class="book-card-btn" type="button">see more</button>
    </li>
  `;_.innerHTML=e}_&&(k(),_?.addEventListener("click",B));const L=document.querySelector(".collection-title");async function B(e){if("BUTTON"!==e.target.nodeName)return;let t=e.target;if(t.matches("button[data-category]")){let e=t.dataset.category;console.log(e);let r=await w.fetchBooksByCategory(e),a=await r.data;console.log(a);let n=a.map(({title:t,book_image:r,author:a,_id:n})=>(L.textContent=e,console.log(L.textContent),`<li class="flex-element" id="${n}">
      <img src="${r}" alt="${t}">
      <h2>${t}</h2>
      <p>${a}</p>
  </li>`)).join("");_.innerHTML=n}}_.addEventListener("click",B);var u=d("3L4y6"),C={};C=new URL(d("kyEFX").resolve("kRCxU"),import.meta.url).toString();var D={};D=new URL(d("kyEFX").resolve("45Fu3"),import.meta.url).toString();var I={};I=new URL(d("kyEFX").resolve("3SUJU"),import.meta.url).toString();var T={};T=new URL(d("kyEFX").resolve("igZ6H"),import.meta.url).toString();var A={};A=new URL(d("kyEFX").resolve("YfQvy"),import.meta.url).toString();var $={};$=new URL(d("kyEFX").resolve("5pNEw"),import.meta.url).toString();const N=document.querySelector("#allModal"),O=document.querySelector(".books-gallery"),M=document.querySelector(".add-storage-button"),R=document.querySelector(".remove-storage-btn"),H=document.querySelector(".storage-info"),x=new u.APIService,P="storage-data";let V=[],U={};O&&(M.addEventListener("click",function(){let e=JSON.parse(localStorage.getItem(P)),t=U;e&&0!==e.length?(e.push(t),localStorage.setItem(P,JSON.stringify(e))):(V.push(t),localStorage.setItem(P,JSON.stringify(V))),H.textContent="Сongratulations! You have added the book to the shopping list. To delete, press the button “Remove from the shopping list”.",J()}),R.addEventListener("click",function(){H.textContent="";let e=U.id,t=JSON.parse(localStorage.getItem(P)),r=t.findIndex(t=>t.id===e);t.splice(r,1),localStorage.setItem(P,JSON.stringify(t)),J()}),O.addEventListener("click",function(e){if("BUTTON"===e.target.nodeName||"UL"===e.target.nodeName||"DIV"===e.target.nodeName||"H3"===e.target.nodeName)return;let t=e.target.closest("li").id;F.classList.remove("is-hidden"),j.classList.remove("is-hidden"),W(t)}));const F=document.querySelector(".about-book-modal"),j=document.querySelector(".card-backdrop-modal");async function W(e){N.innerHTML="";try{let t=await q(e);return J(),function(e){let t=e.book_image,a=e.title,n=e.author,o=e.buy_links[0].url,i=e.buy_links[1].url,s=e.buy_links[4].url,l=e.description,c=l;""===l&&(c="Unfortunately, a brief description of this book is currently unavailable. But let that not hinder you from opening its pages and immersing yourself in the unforgettable world it creates.");let h=`  
  <img src="${t}" alt="Book Image" class="image-about-book-modal">
  <div class="info-modal">
  <h2 class="title-about-book-modal">${a}</h2>
  <p class="author-about-book-modal"> ${n}</p>
  <p class="text-about-book-modal">${c}</p>
  <ul class="shop-modal-list"> <li class="shop-modal-item"><a href="${o}" target="_blank"
    > <img
     width="62"
    height="19"
    srcset="
    ${r(C)} 1x,
    ${r(D)} 2x
  "
   src="${r(C)}"
    alt="Amazon"
  /></a></li>
  <li class="shop-modal-item"><a href="${i}" target="_blank"
    > <img
    width="33"
    height="32"
    srcset="
    ${r(I)} 1x,
    ${r(T)} 2x
  "
   src="${r(I)}"
    alt="AppleBooks"
  /></a></li>
  <li class="shop-modal-item"><a href="${s}" target="_blank"
    > <img
    width="38"
    height="36"
    srcset="
    ${r(A)} 1x,
    ${r($)} 2x
  "
   src="${r(A)}"
    alt="Book-Shop"
  /></a></li>
</ul>
</div>
  `;N.innerHTML=h}(t),t}catch(e){throw console.error("Error",e),e}}async function q(e){try{U={};let t=await x.fetchBookInfo(e),r=t.data;return U={book_image:r.book_image,title:r.title,author:r.author,marketAmazon:r.buy_links[0].url,marketAppleBooks:r.buy_links[1].url,marketBookshop:r.buy_links[4].url,list_name:r.list_name,id:r._id,description:r.description},r}catch(e){throw console.error("Error",e),e}}function J(){let e=JSON.parse(localStorage.getItem(P)),t=U.id;if(e&&0!==e.length){let r=e.find(e=>e.id===t);r?(M.style.display="none",R.style.display="block"):(M.style.display="block",R.style.display="none")}else{M.style.display="block",R.style.display="none";return}}const G=document.querySelector(".card-backdrop-modal"),X=document.querySelector(".modal"),K=document.getElementById("modal-close");function Y(){G.classList.add("is-hidden"),X.classList.add("is-hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",z)}function z(e){"Escape"===e.key&&Y()}X&&(G.addEventListener("click",function(e){e.target===G&&Y()}),K.addEventListener("click",function(){Y()}));const Z=document.querySelector(".authorisation-btn"),Q=document.querySelector(".modal-login-form"),ee=document.querySelector(".modal-login-form-close-btn"),et=document.querySelector(".overlayLoginForm");function er(){Q.style.display="none",et.style.display="none"}Q&&(Z.onclick=function(){Q.style.display="block",et.style.display="block"},ee.onclick=er,window.onclick=function(e){(e.target===Q||e.target===et)&&er()},window.addEventListener("keydown",function(e){"Escape"===e.key&&er()})),d("bMp0K"),d("4Z4PC");const ea={btn:document.querySelector(".scrollBtn"),show(){this.btn.classList.remove("scrollBtn-hide")},hide(){this.btn.classList.add("scrollBtn-hide")},addEventListener(){this.btn&&(window.addEventListener("scroll",()=>{let e=window.scrollY||document.documentElement.scrollTop;e>100?this.show():this.hide()}),this.btn.onclick=()=>{window.scrollTo({top:0,behavior:"smooth"})})}};ea.addEventListener();var en={};function eo(){throw Error("setTimeout has not been defined")}function ei(){throw Error("clearTimeout has not been defined")}function es(e){if(n===setTimeout)return setTimeout(e,0);if((n===eo||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:eo}catch(e){n=eo}try{o="function"==typeof clearTimeout?clearTimeout:ei}catch(e){o=ei}}();var el=[],ec=!1,eh=-1;function ed(){ec&&i&&(ec=!1,i.length?el=i.concat(el):eh=-1,el.length&&eu())}function eu(){if(!ec){var e=es(ed);ec=!0;for(var t=el.length;t;){for(i=el,el=[];++eh<t;)i&&i[eh].run();eh=-1,t=el.length}i=null,ec=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===ei||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function ef(e,t){this.fun=e,this.array=t}function ep(){}en.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];el.push(new ef(e,t)),1!==el.length||ec||es(eu)},ef.prototype.run=function(){this.fun.apply(null,this.array)},en.title="browser",en.browser=!0,en.env={},en.argv=[],en.version="",en.versions={},en.on=ep,en.addListener=ep,en.once=ep,en.off=ep,en.removeListener=ep,en.removeAllListeners=ep,en.emit=ep,en.prependListener=ep,en.prependOnceListener=ep,en.listeners=function(e){return[]},en.binding=function(e){throw Error("process.binding is not supported")},en.cwd=function(){return"/"},en.chdir=function(e){throw Error("process.chdir is not supported")},en.umask=function(){return 0};const eg=function(e){let t=[],r=0;for(let a=0;a<e.length;a++){let n=e.charCodeAt(a);n<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):(64512&n)==55296&&a+1<e.length&&(64512&e.charCodeAt(a+1))==56320?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++a)),t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128)}return t},em=function(e){let t=[],r=0,a=0;for(;r<e.length;){let n=e[r++];if(n<128)t[a++]=String.fromCharCode(n);else if(n>191&&n<224){let o=e[r++];t[a++]=String.fromCharCode((31&n)<<6|63&o)}else if(n>239&&n<365){let o=e[r++],i=e[r++],s=e[r++],l=((7&n)<<18|(63&o)<<12|(63&i)<<6|63&s)-65536;t[a++]=String.fromCharCode(55296+(l>>10)),t[a++]=String.fromCharCode(56320+(1023&l))}else{let o=e[r++],i=e[r++];t[a++]=String.fromCharCode((15&n)<<12|(63&o)<<6|63&i)}}return t.join("")},eb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let t=0;t<e.length;t+=3){let n=e[t],o=t+1<e.length,i=o?e[t+1]:0,s=t+2<e.length,l=s?e[t+2]:0,c=n>>2,h=(3&n)<<4|i>>4,d=(15&i)<<2|l>>6,u=63&l;s||(u=64,o||(d=64)),a.push(r[c],r[h],r[d],r[u])}return a.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(eg(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):em(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let t=0;t<e.length;){let n=r[e.charAt(t++)],o=t<e.length,i=o?r[e.charAt(t)]:0;++t;let s=t<e.length,l=s?r[e.charAt(t)]:64;++t;let c=t<e.length,h=c?r[e.charAt(t)]:64;if(++t,null==n||null==i||null==l||null==h)throw new ey;let d=n<<2|i>>4;if(a.push(d),64!==l){let e=i<<4&240|l>>2;if(a.push(e),64!==h){let e=l<<6&192|h;a.push(e)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class ey extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ev=function(e){let t=eg(e);return eb.encodeByteArray(t,!0)},eE=function(e){return ev(e).replace(/\./g,"")};class ew extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,ew.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,e_.prototype.create)}}class e_{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},a=`${this.service}/${e}`,n=this.errors[e],o=n?n.replace(eS,(e,t)=>{let a=r[t];return null!=a?String(a):`<${t}?>`}):"Error",i=`${this.serviceName}: ${o} (${a}).`,s=new ew(a,i,r);return s}}const eS=/\{\$([^}]+)}/g;class ek{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const eL=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const eB={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},eC=s.INFO,eD={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},eI=(e,t,...r)=>{if(t<e.logLevel)return;let a=new Date().toISOString(),n=eD[t];if(n)console[n](`[${a}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)},eT=(e,t)=>t.some(t=>e instanceof t),eA=new WeakMap,e$=new WeakMap,eN=new WeakMap,eO=new WeakMap,eM=new WeakMap;let eR={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return e$.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eN.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eH(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eH(r){var a;if(r instanceof IDBRequest)return function(e){let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",o)},n=()=>{t(eH(e.result)),a()},o=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&eA.set(t,e)}).catch(()=>{}),eM.set(t,e),t}(r);if(eO.has(r))return eO.get(r);let n="function"==typeof(a=r)?a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...e){return a.apply(ex(this),e),eH(eA.get(this))}:function(...e){return eH(a.apply(ex(this),e))}:function(e,...t){let r=a.call(ex(this),e,...t);return eN.set(r,e.sort?e.sort():[e]),eH(r)}:(a instanceof IDBTransaction&&function(e){if(e$.has(e))return;let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",o),e.removeEventListener("abort",o)},n=()=>{t(),a()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",o),e.addEventListener("abort",o)});e$.set(e,t)}(a),eT(a,e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(a,eR):a;return n!==r&&(eO.set(r,n),eM.set(n,r)),n}const ex=e=>eM.get(e),eP=["get","getKey","getAll","getAllKeys","count"],eV=["put","add","delete","clear"],eU=new Map;function eF(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eU.get(t))return eU.get(t);let r=t.replace(/FromIndex$/,""),a=t!==r,n=eV.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||eP.includes(r)))return;let o=async function(e,...t){let o=this.transaction(e,n?"readwrite":"readonly"),i=o.store;return a&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),n&&o.done]))[0]};return eU.set(t,o),o}eR={...a=eR,get:(e,t,r)=>eF(e,t)||a.get(e,t,r),has:(e,t)=>!!eF(e,t)||a.has(e,t)};class ej{constructor(e){this.container=e}getPlatformInfoString(){let e=this.container.getProviders();return e.map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const eW="@firebase/app",eq="0.9.12",eJ=new class{constructor(e){this.name=e,this._logLevel=eC,this._logHandler=eI,this._userLogHandler=null,eL.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}("@firebase/app"),eG={[eW]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},eX=new Map,eK=new Map;function eY(e){let t=e.name;if(eK.has(t))return eJ.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eK.set(t,e),eX.values()))!function(e,t){try{e.container.addComponent(t)}catch(r){eJ.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}(r,e);return!0}const ez=new e_("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});function eZ(e,t,r){var a;let n=null!==(a=eG[e])&&void 0!==a?a:e;r&&(n+=`-${r}`);let o=n.match(/\s|\//),i=t.match(/\s|\//);if(o||i){let e=[`Unable to register library "${n}" with version "${t}":`];o&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),o&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eJ.warn(e.join(" "));return}eY(new ek(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}const eQ="firebase-heartbeat-store";let e1=null;function e0(){return e1||(e1=(function(e,t,{blocked:r,upgrade:a,blocking:n,terminated:o}={}){let i=indexedDB.open(e,1),s=eH(i);return a&&i.addEventListener("upgradeneeded",e=>{a(eH(i.result),e.oldVersion,e.newVersion,eH(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(eQ)}}).catch(e=>{throw ez.create("idb-open",{originalErrorMessage:e.message})})),e1}async function e2(e){try{let t=await e0(),r=await t.transaction(eQ).objectStore(eQ).get(e3(e));return r}catch(e){if(e instanceof ew)eJ.warn(e.message);else{let t=ez.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eJ.warn(t.message)}}}async function e6(e,t){try{let r=await e0(),a=r.transaction(eQ,"readwrite"),n=a.objectStore(eQ);await n.put(t,e3(e)),await a.done}catch(e){if(e instanceof ew)eJ.warn(e.message);else{let t=ez.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eJ.warn(t.message)}}}function e3(e){return`${e.name}!${e.options.appId}`}class e4{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new e9(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate(),t=e.getPlatformInfoString(),r=e5();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf(),r=Date.now();return r-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=e5(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],a=e.slice();for(let n of e){let e=r.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),e8(r)>t){e.dates.pop();break}}else if(r.push({agent:n.agent,dates:[n.date]}),e8(r)>t){r.pop();break}a=a.slice(1)}return{heartbeatsToSend:r,unsentEntries:a}}(this._heartbeatsCache.heartbeats),a=eE(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}}function e5(){let e=new Date;return e.toISOString().substring(0,10)}class e9{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0,a="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(a);n.onsuccess=()=>{n.result.close(),r||self.indexedDB.deleteDatabase(a),e(!0)},n.onupgradeneeded=()=>{r=!1},n.onerror=()=>{var e;t((null===(e=n.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){let e=await this._canUseIndexedDBPromise;if(!e)return{heartbeats:[]};{let e=await e2(this.app);return e||{heartbeats:[]}}}async overwrite(e){var t;let r=await this._canUseIndexedDBPromise;if(r){let r=await this.read();return e6(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;let r=await this._canUseIndexedDBPromise;if(r){let r=await this.read();return e6(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function e8(e){return eE(JSON.stringify({version:2,heartbeats:e})).length}eY(new ek("platform-logger",e=>new ej(e),"PRIVATE")),eY(new ek("heartbeat",e=>new e4(e),"PRIVATE")),eZ(eW,eq,""),eZ(eW,eq,"esm2017"),eZ("fire-js",""),eZ("firebase","9.22.2","app");
//# sourceMappingURL=group.08ab237d.js.map
